Ссылка на проект - https://github.com/Dbl4/Auth_sprint_1

[Техническое задание](documentation/requirements.md)

# Описание системы
[Блок-схема системы](documentation/block-scheme.md)

[ER-диаграмма PostgreSQL сервиса Admin](documentation/admin-er-diagram.md)

[ER-диаграмма PostgreSQL сервиса Auth](documentation/auth-api/auth-er-diagram.md)

## Сервис Auth API
Сервис Auth API предназначен для аутентификации пользователей. Сервис управляет списком пользователей. Пользователь может быть простым или администратором. Посредством API можно создать только простого пользователя. Создать администратора можно из командной строки.

Сервис Auth API реализует механизм управления ролями пользователей. Пользователь может иметь до нескольких ролей. Auth API только выполняет аутентификацию и предоставляет механизм управления ролями. Интерпретирует суть роли и ограничивает доступ к контенту прикладной сервис - Async API, Frontend... Возможные роли - `subscriber`, `trial`, `adult`…

Управлять ролями может только администратор. Пароль администратора выдается только доверенному сервису. Это позволяет ограничить риски несанкционированного использования сервиса при условии свободного доступа к API.

# Сборка и запуск системы
Для сборки и запуска приложения в терминале перейдите в папку проекта и используйте следующие команды.

## Первый запуск системы
Сформировать файл `.env`.
(Опционально) Запустить виртуальное окружение.
Установить зависимости `pip install -r requirements.txt`.
Cкомпилировать контейнеры `make build`.
Запустить приложения в режиме разработки `make dev`.
Загрузить начальные данные в Postgres `make loaddata`.
После загрузки данных необходимо заново запустить ETL (или перезапустить всю систему).

## Остановка системы 
Остановка контейнеров `make down`.

## Запуск системы в режиме разработки
Запуск системы `make dev`.
В этом режиме открыты порты всех основных контейнеров.
Для дебага приложения fastapi или etl можно остановить соответстующий контейнер и запускать приложение скриптом `main.sh`, расположенным в папке приложения.
Для запуска тестов на локальном компьютере использовать `pytest`.

## Запуск системы в производственном режиме без тестов
Запуск системы `make up`.
В этом режиме открыт только порт nginx:80.

## Запуск системы в производственном режиме с тестами
Запуск системы `make test`.
В этом режиме открыт только порт nginx:80.
Контейнер nginx запускается только если успешно проходят тесты в контейнере tests.
